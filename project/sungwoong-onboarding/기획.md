# 설문조사 시스템 개발 계획

## 1. 프로젝트 개요
설문조사 서비스는 설문조사 양식을 만들고, 만들어진 양식 기반으로 응답을 받을 수 있는 서비스입니다. 본 프로젝트는 설문조사 생성, 수정, 응답 제출, 응답 조회 기능을 제공하는 API를 개발하는 것을 목표로 합니다.

### 1.1 프로젝트 목표
- 사용자가 다양한 형태의 설문조사를 쉽게 생성하고 관리할 수 있는 API 제공
- 설문 응답 데이터를 효율적으로 수집하고 조회할 수 있는 기능 구현
- 확장성과 유지보수성이 높은 아키텍처 설계
- 안정적이고 성능이 우수한 서비스 구현

### 1.2 핵심 기능
- 다양한 질문 유형(단답형, 장문형, 단일/다중 선택)을 지원하는 설문조사 생성
- 기존 응답을 유지하면서 설문조사 수정 가능
- 설문조사 응답 제출 및 검증
- 설문조사 응답 조회 및 검색

## 2. 도메인 모델 설계

### 주요 도메인 엔티티
1. **설문지(Form)**
   - 설문조사 이름
   - 설문조사 설명
   - 생성일시
   - 수정일시

2. **질문(Question)**
   - 항목 이름
   - 항목 설명
   - 항목 입력 형태 (단답형, 장문형, 단일 선택 리스트, 다중 선택 리스트)
   - 항목 필수 여부
   - 질문 순서

3. **질문 옵션(QuestionOption)**
   - 옵션 내용
   - 옵션 순서 (단일/다중 선택 리스트에서 사용)

4. **응답지(Response)**
   - 응답 일시
   - 설문지 참조

5. **답변(Answer)**
   - 질문 참조
   - 답변 내용
   - 선택한 옵션 (단일/다중 선택 리스트의 경우)

### 관계 설계
- 설문지(Form) 1 : N 질문(Question)
- 질문(Question) 1 : N 질문 옵션(QuestionOption) (단일/다중 선택 리스트인 경우)
- 설문지(Form) 1 : N 응답지(Response)
- 응답지(Response) 1 : N 답변(Answer)
- 질문(Question) 1 : N 답변(Answer)

## 3. API 명세

### 1. 설문조사 생성 API
- **엔드포인트**: POST /api/forms
- **요청 데이터**: 
  - 설문조사 이름
  - 설문조사 설명
  - 설문 받을 항목 목록 (1~10개)
    - 항목 이름
    - 항목 설명
    - 항목 입력 형태
    - 항목 필수 여부
    - 선택 옵션 목록 (단일/다중 선택 리스트인 경우)
- **응답 데이터**:
  - 생성된 설문조사 ID
  - 설문조사 이름
  - 생성 일시

### 2. 설문조사 수정 API
- **엔드포인트**: PUT /api/forms/{formId}
- **요청 데이터**:
  - 설문조사 이름
  - 설문조사 설명
  - 설문 받을 항목 목록
    - 항목 ID (기존 항목인 경우)
    - 항목 이름
    - 항목 설명
    - 항목 입력 형태
    - 항목 필수 여부
    - 선택 옵션 목록 (단일/다중 선택 리스트인 경우)
- **응답 데이터**:
  - 수정된 설문조사 ID
  - 설문조사 이름
  - 수정 일시

### 3. 설문조사 응답 제출 API
- **엔드포인트**: POST /api/forms/{formId}/responses
- **요청 데이터**:
  - 답변 목록
    - 질문 ID
    - 답변 내용 (단답형, 장문형)
    - 선택한 옵션 ID 목록 (단일/다중 선택 리스트)
- **응답 데이터**:
  - 응답 ID
  - 제출 일시

### 4. 설문조사 응답 조회 API
- **엔드포인트**: GET /api/forms/{formId}/responses
- **요청 파라미터**:
  - 검색 조건 (선택적): 항목 이름, 응답 값
- **응답 데이터**:
  - 응답 목록
    - 응답 ID
    - 제출 일시
    - 답변 목록
      - 질문 정보
      - 답변 내용

## 4. 구현 전략

### 4.1 기술 스택
- Java 11 이상
- Spring Boot 2.7.x
- Spring Data JPA
- H2 Database (인메모리 RDBMS)
- Gradle
- JUnit 5 & Mockito (테스트)
- Lombok (코드 간소화)
- Spring Validation (입력 검증)

### 4.2 아키텍처 설계
- **계층형 아키텍처**: 프레젠테이션, 애플리케이션, 도메인, 인프라스트럭처 계층으로 구성
- **헥사고날 아키텍처 원칙 적용**: 도메인 중심 설계와 포트-어댑터 패턴을 활용하여 외부 의존성 분리
- **CQRS 패턴 고려**: 복잡한 조회 기능에 대해 명령과 조회 책임 분리 검토

### 4.3 패키지 구조
```
com.multi.sungwoongonboarding
├── common
│   ├── exception
│   │   ├── GlobalExceptionHandler.java
│   │   ├── BusinessException.java
│   │   └── ErrorResponse.java
│   ├── util
│   └── config
├── forms
│   ├── application
│   │   ├── FormService.java
│   │   └── repository
│   ├── domain
│   │   ├── Form.java
│   │   ├── Question.java
│   │   └── QuestionOption.java
│   ├── dto
│   │   ├── request
│   │   │   ├── FormCreateRequest.java
│   │   │   └── FormUpdateRequest.java
│   │   └── response
│   │       ├── FormResponse.java
│   │       └── QuestionResponse.java
│   └── presentation
│       └── FormController.java
└── responses
    ├── application
    │   ├── ResponseService.java
    │   └── repository
    ├── domain
    │   ├── Response.java
    │   └── Answer.java
    ├── dto
    │   ├── request
    │   │   └── ResponseSubmitRequest.java
    │   └── response
    │       └── ResponseDetailResponse.java
    └── presentation
        └── ResponseController.java
```

### 4.4 구현 접근 방식
1. **도메인 모델 구현**
   - JPA 엔티티 설계 및 구현
   - 엔티티 간 관계 설정
   - 도메인 로직 캡슐화
   - 불변성 보장을 위한 설계

2. **레포지토리 계층 구현**
   - Spring Data JPA 활용
   - 필요한 쿼리 메소드 정의
   - 복잡한 쿼리는 JPQL 또는 QueryDSL 활용 검토
   - 페이징 및 정렬 지원

3. **서비스 계층 구현**
   - 비즈니스 로직 구현
   - 트랜잭션 관리
   - 도메인 이벤트 처리
   - 유효성 검증

4. **컨트롤러 계층 구현**
   - REST API 엔드포인트 정의
   - 요청 검증
   - 응답 데이터 구성
   - API 버전 관리 전략

5. **예외 처리**
   - 글로벌 예외 핸들러 구현
   - 사용자 정의 예외 클래스 정의
   - 일관된 에러 응답 형식 제공
   - 예외 로깅 전략

### 4.5 코드 품질 관리
1. **코딩 컨벤션**
   - Google Java Style Guide 준수
   - 일관된 네이밍 규칙 적용
   - 주석 및 문서화 표준 준수

2. **정적 코드 분석**
   - SonarQube 또는 SpotBugs 활용 검토
   - 코드 중복, 복잡도, 잠재적 버그 식별

3. **코드 리뷰**
   - PR 기반 코드 리뷰 프로세스
   - 코드 품질, 가독성, 성능 측면 검토

### 4.6 성능 최적화
1. **데이터베이스 최적화**
   - 적절한 인덱스 설계
   - N+1 문제 방지를 위한 페치 전략
   - 대용량 데이터 처리를 위한 페이징 구현

2. **캐싱 전략**
   - 자주 조회되는 데이터에 대한 캐싱 검토
   - Spring Cache 활용 가능성 검토

3. **비동기 처리**
   - 대량 응답 처리 시 비동기 방식 검토
   - CompletableFuture 활용 가능성

## 5. 테스트 전략

### 5.1 테스트 계층

#### 단위 테스트
- 각 서비스 메소드에 대한 단위 테스트
- 레포지토리 메소드에 대한 테스트
- 도메인 모델의 비즈니스 로직 테스트
- Mockito를 활용한 의존성 모킹
- JUnit 5의 파라미터화된 테스트 활용

#### 통합 테스트
- 컨트롤러 엔드포인트에 대한 테스트 (MockMvc 활용)
- 실제 요청/응답 시나리오 테스트
- 데이터베이스 연동 테스트 (@DataJpaTest 활용)
- 전체 애플리케이션 컨텍스트 로드 테스트 (@SpringBootTest 활용)

#### E2E 테스트
- 주요 사용자 시나리오에 대한 엔드투엔드 테스트
- 실제 HTTP 요청/응답을 통한 테스트 (TestRestTemplate 활용)

### 5.2 테스트 접근 방식
- **TDD(Test-Driven Development)** 고려: 테스트 먼저 작성 후 구현
- **BDD(Behavior-Driven Development)** 스타일 적용: Given-When-Then 패턴
- **테스트 커버리지** 목표: 80% 이상의 코드 커버리지
- **테스트 데이터 관리**: 테스트용 데이터 팩토리 패턴 활용

### 5.3 테스트 범위
1. **설문조사 생성 API 테스트**
   - 유효한 요청으로 설문조사 생성
   - 유효하지 않은 요청 (필수 필드 누락, 질문 개수 초과 등)
   - 경계값 테스트 (최소/최대 질문 개수)
   - 동시성 테스트 (여러 요청 동시 처리)

2. **설문조사 수정 API 테스트**
   - 기존 설문조사 수정
   - 질문 추가/수정/삭제 시나리오
   - 존재하지 않는 설문조사 수정 시도
   - 기존 응답 유지 검증
   - 동시 수정 시나리오 테스트

3. **설문조사 응답 제출 API 테스트**
   - 유효한 응답 제출
   - 필수 질문 누락
   - 유효하지 않은 옵션 선택
   - 대량 응답 제출 성능 테스트
   - 다양한 질문 유형별 응답 검증

4. **설문조사 응답 조회 API 테스트**
   - 전체 응답 조회
   - 검색 조건에 따른 응답 필터링
   - 페이징 및 정렬 테스트
   - 대량 데이터 조회 성능 테스트

### 5.4 테스트 자동화
- CI/CD 파이프라인에 테스트 통합
- 테스트 보고서 자동 생성
- 테스트 실패 시 알림 메커니즘
- 정기적인 회귀 테스트 실행

## 6. 모니터링 및 로깅 전략

### 6.1 로깅 전략
- **구조화된 로깅**: JSON 형식의 로그 출력으로 분석 용이성 확보
- **로그 레벨 관리**: 환경별 적절한 로그 레벨 설정 (개발: DEBUG, 운영: INFO)
- **컨텍스트 정보 포함**: 요청 ID, 사용자 정보 등 컨텍스트 정보 포함
- **중요 이벤트 로깅**: 
  - API 호출 시작/종료
  - 예외 발생 상황
  - 비즈니스 중요 이벤트 (설문 생성, 응답 제출 등)
- **민감 정보 마스킹**: 개인정보 등 민감 정보 로깅 시 마스킹 처리

### 6.2 모니터링 전략
- **애플리케이션 건강 상태 모니터링**: Spring Actuator를 활용한 애플리케이션 상태 모니터링
- **성능 메트릭 수집**: 
  - API 응답 시간
  - 데이터베이스 쿼리 성능
  - 메모리 사용량
  - GC 활동
- **알림 설정**: 
  - 오류율 임계치 초과 시 알림
  - 응답 시간 지연 시 알림
  - 리소스 사용량 임계치 초과 시 알림
- **대시보드 구성**: 주요 지표를 시각화한 대시보드 구성

### 6.3 장애 대응 전략
- **장애 감지 자동화**: 모니터링 시스템을 통한 장애 조기 감지
- **로그 기반 원인 분석**: 구조화된 로그를 활용한 장애 원인 신속 분석
- **롤백 전략**: 장애 발생 시 이전 버전으로 신속 롤백 방안 마련
- **장애 보고서**: 장애 발생 시 원인, 영향, 해결책, 재발 방지 대책을 포함한 보고서 작성

## 7. 개발 일정

### 1주차
- 요구사항 분석 및 설계
- 도메인 모델 구현
- 레포지토리 계층 구현
- 서비스 계층 구현
- 설문조사 생성/수정 API 구현
- 단위 테스트 작성
  설문조사 응답 제출/조회 API 구현
- 통합 테스트 작성

### 2주차
- 버그 수정 및 리팩토링

### 4주차
- 전체 기능 테스트
- 코드 리뷰 및 개선
- 문서화 및 최종 제출

## 8. 고려사항 및 제약사항

### 8.1 성능 고려사항
- **대량의 설문조사 응답 처리 방안**
  - 비동기 처리를 통한 응답 시간 개선
  - 배치 처리를 통한 대량 데이터 효율적 처리
  - 데이터베이스 인덱스 최적화
- **응답 조회 시 최적화**
  - 페이징 및 정렬 처리
  - 필요한 데이터만 조회하는 프로젝션 활용
  - 복잡한 조회 쿼리의 성능 최적화

### 8.2 보안 고려사항
- **입력 데이터 검증**
  - 모든 사용자 입력에 대한 유효성 검증
  - XSS 및 인젝션 공격 방지
  - 입력 데이터 크기 제한
- **API 접근 제어**
  - API 요청 제한 (Rate Limiting)
  - 적절한 인증/인가 메커니즘 검토
  - 민감한 API에 대한 추가 보안 조치

### 8.3 확장성 고려사항
- **새로운 질문 유형 추가 가능성**
  - 확장 가능한 질문 유형 설계
  - 전략 패턴을 활용한 질문 유형별 처리 로직 분리
  - 새로운 유형 추가 시 기존 코드 변경 최소화
- **다국어 지원 가능성**
  - 국제화(i18n) 지원 설계
  - 메시지 리소스 분리
  - 다국어 데이터 저장 구조 고려

### 8.4 제약사항
- **인메모리 DB 사용으로 인한 영속성 제약**
  - 애플리케이션 재시작 시 데이터 손실 가능성
  - 대용량 데이터 처리의 한계
  - 프로덕션 환경으로 전환 시 고려사항
- **프론트엔드 구현 금지**
  - API 문서화를 통한 프론트엔드 개발 지원
  - API 테스트를 위한 Postman 컬렉션 제공
  - 명확한 API 계약 정의
